<!DOCTYPE html>
<html ng-app="jassa.ui.edit.demo.widgets">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <title>RDF Edit Demo</title>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- build:css(.tmp) styles/main.css -->

    <!-- bower:css -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="bower_components/ng-grid/ng-grid.css" />
    <link rel="stylesheet" href="bower_components/jassa-ui-angular/jassa-ui-angular.css" />
    <link rel="stylesheet" href="bower_components/codemirror/lib/codemirror.css" />
    <!-- endbower -->

    <link rel="stylesheet" href="css/style.css" />

    <!-- endbuild -->

    <!-- bower:js -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/angular-ui-bootstrap-bower/ui-bootstrap-tpls.js"></script>
    <script src="bower_components/jassa/jassa.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script src="bower_components/ng-grid/build/ng-grid.js"></script>
    <script src="bower_components/angular-sanitize/angular-sanitize.js"></script>
    <script src="bower_components/jquery-ui/ui/jquery-ui.js"></script>
    <script src="bower_components/angular-ui-sortable/sortable.js"></script>
    <script src="bower_components/angular-ui-utils/ui-utils.js"></script>
    <script src="bower_components/jassa-ui-angular/jassa-ui-angular-tpls.js"></script>
    <script src="bower_components/bluebird/js/browser/bluebird.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>
    <script src="bower_components/codemirror/lib/codemirror.js"></script>
    <script src="bower_components/angular-ui-codemirror/ui-codemirror.js"></script>
    <script src="bower_components/moment/moment.js"></script>
    <!-- endbower -->

    <!-- endbuild -->


    <!-- End of automatic generated header - custom content below -->

    <style>
    .input-group-addon {
        min-width:100px;
        text-align:left;
    }
    </style>

    <script src="lib/turtle-codemirror-mode/turtle-codemirror-mode.js"></script>

    <script type="text/javascript">
    // Init jassa
    jassa = new Jassa(Promise, $.ajax);
    </script>

    <script src="jassa-ui-angular-edit-tpls-0.1.0.js"></script>



    <script type="text/javascript">
    jassa = new Jassa(Promise, $.ajax);

    var app = angular.module(
        'jassa.ui.edit.demo.widgets',
        ['ngSanitize', 'ui.bootstrap', 'ui.jassa.edit', 'ui.codemirror'])

    .controller('AppCtrl', ['$scope', '$location', '$anchorScroll', '$timeout', function($scope, $location, $anchorScroll, $timeout) {

        // Begin of REX Setup

        $scope.defaultNgModelOptions = {
            //updateOn: 'default blur',
            debounce: {
                'default': 300,
                'blur': 0
            }
        };

        var sparqlService = jassa.service.SparqlServiceBuilder
            //.http('http://dbpedia.org/sparql', ['http://dbpedia.org'], {type: 'POST'})
            .http('http://akswnc3.informatik.uni-leipzig.de/data/dbpedia/sparql', ['http://dbpedia.org'], {type: 'POST'})
            .cache().virtFix().paginate(50000).pageExpand(100).create();


        $scope.lookupFn = function(node) {
            var result = jassa.service.ServiceUtils.execDescribeViaSelect(sparqlService, [node]);
            return result;
        };

        $scope.newGraph = function() {
            return new jassa.rdf.GraphImpl();
        };


        $scope.graphToTurtle = function(graph, prefixMapping) {
            var talis = graph ? jassa.io.TalisRdfJsonUtils.triplesToTalisRdfJson(graph) : null;
            var r = talis ? jassa.io.TalisRdfJsonUtils.talisRdfJsonToTurtle(talis, prefixMapping) : '';
            return r;
        }
        // End of REX Setup

        // Some Utils for geo stuff
        $scope.PointUtils = jassa.geo.PointUtils;


        // Helper for date parsing / serialization
        // !!! Does not actually produce date strings as demanded by xsd date(Time) !!!
        // !!! Its just a proof of concept !!!
        // TODO integrate moment.js
        // Native Javascript Date features seem to be insanely useless when it comes to RDF :/
        $scope.dateToString = function(x) {
            var r = !x ? null : moment(x).toISOString();
            //var r = !x ? null : x.toUTCString();
            return r;
        };

        $scope.parseDate = function(x) {
            var r = !x ? null : moment(x).toDate();
            //var r = !x ? null : new Date(x);
            return r;
        };


        // Helper to keep an input field at the top of the page
        $scope.scrollTo = function(target) {
            $timeout(function() {
                $location.hash(target);
                $anchorScroll();
            }, 50);
        };

        // Code mirror setup
        $scope.editorOptions = {
            ttl: {
                lineWrapping : true,
                lineNumbers: true,
                tabMode: 'indent',
                matchBrackets: true,
                mode: 'text/turtle',
                readOnly: true
            }
        };

        // Angular UI date picker set up
        $scope.dp = {};

        $scope.clear = function () {
            $scope.dt = null;
        };

        // Disable weekend selection
        $scope.disabled = function(date, mode) {
            return ( mode === 'day' && ( date.getDay() === 0 || date.getDay() === 6 ) );
        };

        $scope.toggleMin = function() {
            $scope.minDate = $scope.minDate ? null : new Date();
        };
        $scope.toggleMin();

        $scope.dp.opened = false;
        $scope.open = function($event) {
            $event.preventDefault();
            $event.stopPropagation();

            $scope.dp.opened = true;
        };

        $scope.dateOptions = {
            formatYear: 'yyyy',
            startingDay: 1
        };
    }]);


    </script>
</head>


<body ng-controller="AppCtrl">
<div class="container">
    <div class="row">
        <div class="col-md-10 col-md-offset-1">
            <div ng-include="'forms/dynamic.html'"></div>

            <div ng-include="'forms/geo.html'"></div>

            <div ng-include="'forms/person-form.html'"></div>

            <div ng-include="'forms/simple-editor.html'"></div>

        </div>
    </div>
</div>
</body>

</html>
