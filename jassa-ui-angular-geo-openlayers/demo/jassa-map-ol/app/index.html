<!DOCTYPE html>
<html ng-app="FacetTreeDemo">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <title>Jassa UI Angular: Facet Tree Demo</title>
	
    <!-- bower:css -->
	    <!-- endbower -->

    <link rel="stylesheet" href="../../../target/release/repo/jassa-ui-angular.css" />
	
    <script src="bower_components/jscache/cache.js"></script>

    <!-- bower:js -->
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/jquery-ui/ui/jquery-ui.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>
    <script src="bower_components/jassa/jassa.js"></script>
    <!-- endbower -->

    <script src="lib/angular-ui/0.10.0/ui-bootstrap-tpls-0.10.0.js"></script>
    <script src="bower_components/underscore.string/lib/underscore.string.js"></script>

    <script src="bower_components/openlayers/lib/OpenLayers.js"></script>

    <script src="../../../target/release/repo/jassa-ui-angular-geo-openlayers-tpls.js"></script>
	
	<script type="text/javascript">
    _.mixin(_.str.exports());

	var rdf = Jassa.rdf;
	var sparql = Jassa.sparql;
    var service = Jassa.service;
	var sponate = Jassa.sponate;
    var facete = Jassa.facete;

	var geo = Jassa.geo;

    var myModule = angular.module('FacetTreeDemo', ['ui.bootstrap', 'ui.jassa']);

    myModule.controller('MyCtrl', ['$scope', function($scope) {

		$scope.map = null;

	var conceptWgs84 = new facete.Concept(sparql.ElementString.create('?s <http://www.w3.org/2003/01/geo/wgs84_pos#long> ?x ;  <http://www.w3.org/2003/01/geo/wgs84_pos#lat> ?y'), rdf.NodeFactory.createVar('s'));
	var conceptGeoVocab = new facete.Concept(sparql.ElementString.create('?s <http://www.opengis.net/ont/geosparql#asWKT> ?w'), rdf.NodeFactory.createVar('s'));


	var vs = rdf.NodeFactory.createVar('s');
	var vx = rdf.NodeFactory.createVar('x');
	var vy = rdf.NodeFactory.createVar('y');
	var vw = rdf.NodeFactory.createVar('w');
	
	var geoConcepts = [conceptWgs84, conceptGeoVocab];

		var mapParser = new sponate.MapParser();

		var wgs84GeoView = mapParser.parseMap({
			name: 'lonlat',
			template: [{
				id: conceptWgs84.getVar(), //'?s',
				lon: vx, // '?x',
				lat: vy, // '?y'
				wkt: function(b) { return 'POINT(' + b.get(vx).getLiteralValue() + ' ' + b.get(vy).getLiteralValue() + ')';}
			}],
			from: conceptWgs84.getElement()
		});	
	
		var ogcGeoView = mapParser.parseMap({
			name: 'lonlat',
			template: [{
				id: conceptGeoVocab.getVar(),
				wkt: vw
			}],
			from: conceptGeoVocab.getElement()
		});
    
    
		var intersectsFnName = 'bif:st_intersects';
		var geomFromTextFnName = 'bif:st_geomFromText';
	
	
	    var wgs84MapFactory = new sponate.GeoMapFactory(wgs84GeoView, new geo.BBoxExprFactoryWgs84(vx, vy));
		//var ogcMapFactory = new ns.GeoMapFactory(ogcGeoView, new geo.BBoxExprFactoryWkt(vw));
		var ogcMapFactory = new sponate.GeoMapFactory(ogcGeoView, new geo.BBoxExprFactoryWkt(vw, intersectsFnName, geomFromTextFnName));

    	//var mapLinkFactories = [wgs84MapFactory]; //, ogcMapFactory];

/*
        sparqlService = sparqlServiceFactory.createSparqlService(wsConf.sparqlServiceIri, wsConf.defaultGraphIris);
		facetConfig = conceptSpace.getFacetTreeConfig().getFacetConfig();
		facetConceptGenerator = facete.FaceteUtils.createFacetConceptGenerator(facetConfig);

       	var concept = facetConceptGenerator.createConceptResources(path); 
*/

		var sparqlService = new service.SparqlServiceHttp('http://fp7-pp.publicdata.eu/sparql', ['http://fp7-pp.publicdata.eu/']);
		sparqlService = new service.SparqlServiceCache(sparqlService);
		sparqlService = new service.SparqlServicePaginate(sparqlService, 1000);


        $scope.dataSources = [{
			sparqlService: sparqlService,
			mapLinkFactory: wgs84MapFactory,
			concept: facete.ConceptUtils.createSubjectConcept(rdf.NodeFactory.createVar('s'))
		}];

/*
        var sparqlServiceFactory = new service.SparqlServiceFactoryDefault();

        $scope.sparqlService = sparqlServiceFactory.createSparqlService('http://fp7-pp.publicdata.eu/sparql', []);
//        $scope.sparqlService = sparqlServiceFactory.createSparqlService('http://localhost/fts-sparql', []);

        $scope.facetTreeConfig = new facete.FacetTreeConfig();

        $scope.path = null;

        $scope.selectFacet = function(path) {
            //alert('Selected Path: [' + path + ']');
            $scope.path = path;
        };
*/
    }]);
	</script>

</head>

<body ng-controller="MyCtrl">
   <div jassa-map-ol="map" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%" config="dataSources"></div>
</body>

</html>

