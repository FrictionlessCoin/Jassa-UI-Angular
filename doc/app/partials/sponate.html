<h2>Sponate</h2>
<h3>Overview</h3>
Sponate is a system for mapping result sets of SPARQL Select queries to (usually arrays) of JavaScript entities.
Sponate is particularly useful for chosing the best labels from a set of RDF terms in regard to constraints, such as on the
properties (e.g. skos:prefLabel, rdfs:label) and languages ('en', 'de', '').
Further, Sponate supports transforming values by passing them to JavaScript functions.
In addition, the system supports nested lookups, such that attribute values of an object created from one SPARQL result set
may refer to objects created from another.
Data access is provided via the <code>jassa.service.ListService</code> interface, which makes it possible to
use different keyword search strategies.

<h3>Concepts</h3>
For this purpose </i><i>(sponate) maps</i> need to be defined, which are expressed in JavaScript.
A map is comprised of a name, a SPARQL graph pattern, a template, and optionally a SPARQL service to override a default one.
A <i>(sponate) store</i> is a container for a set of maps and configuration options, such as prefixes and the sparql service.

The system operates by aggregation of result set rows into JavaScript objects and arrays.


<h3>Mapping rules<h3>
<ul>
    <li>
        The id attribute is special: New objects are created on every first encounter of a new id.
    <li>
        If an attribute is of type string, it will be parsed as a SPARQL expression. Hence, constant strings must be enclosed with either single of double quotes.
        If no filter is provided, values will by default be <i>jsonified</i>. In cases where the RDF term is desired, the <i>node</i> filter can be applied.
        Examples: <code>name: '?name'</code> <code>name: '?name | node'</code> <code>name: '"John Doe"'</code>
    <li>
    <li>jassa.rdf.Node and jassa.sparql.NodeValue</li>
</ul>

<h3>Simple Example</h3>

<h4>Attribute Query</h4>
<textarea ui-codemirror="editorOptions.html">
SELECT * WHERE {
 ?r a dbo:Museum .
 ?r rdfs:label ?label .
 ?r dbo:abstract ?abst .
 ?r geo:long ?long .
 ?r geo:lat ?lat .
 OPTIONAL { ?r foaf:depiction ?d }}
</textarea>

<h4>Sponate Data Template</h4>
<textarea ui-codemirror="editorOptions.html">
{
  id: "?r",
  name : "?label",
  abstract: "?abst",
  lat: "?lat",
  long: "?long",
  pic: "?d"
}
</textarea>

<h4>Angular View Template</h4>
<textarea ui-codemirror="editorOptions.html">
<script type="text/plain">
{{name}}
<div ng-hide="pic">(No image available.)</div>
<img src="{{pic.slice(1, -1)}}">
<br/><i>{{abstract}}</i>
</script>
</textarea>

<ul>
    <li><a class="label label-primary" href="http://cstadler.aksw.org/mappify2" target="_blank">Mappify</a></li>
</ul>


<h3>Best Label Aggregation</h3>

<h4>Sponate Data Template</h4>
<textarea ui-codemirror="editorOptions.html">
<script type="text/plain">
var prefixes = {
    'foaf': 'http://xmlns.com/foaf/0.1/',
    'pokedex': 'http://pokedex.dataincubator.org/pkm/'
};

var store = new sponate.StoreFacade(sparqlService, prefixes);

$scope.langs = ['de', 'en', '']; //, 'fr', 'ja', 'it', 'es', ''];

var labelTemplateFn = function() {
    console.log('Refresh: ', $scope.langs);
    var labelConfig = new sparql.BestLabelConfig($scope.langs);
    return sponate.MappedConceptUtils.createMappedConceptBestLabel(labelConfig);
};

var commentTemplateFn = function() {
    var labelConfig = new sparql.BestLabelConfig($scope.langs, [rdf.NodeFactory.createUri(prefixes.pokedex + 'description')]);
    return sponate.MappedConceptUtils.createMappedConceptBestLabel(labelConfig);
};

//console.log('labelConfig ', labelConfig);

store.addMap({
    name: 'pokemons',
    template: [{
        id: '?s',
        label: { $ref: { target: labelTemplateFn } },
        comment: { $ref: { target: commentTemplateFn} },
        depiction: '?d',
    }],
    from: '?s a pokedex:Pokemon . Optional { ?s foaf:depiction ?d }'
});
</script>
</textarea>


<h4>Angular View Template</h4>
<textarea ui-codemirror="editorOptions.html">
<script type="text/plain">
<li class="media" ng-repeat="item in items">
    <a class="pull-left" href="#">
        <div class="thumbnail thumbnail-center" style="width: 100px; height: 100px;">
            <div class="thumbnail-wrapper">
                <img ng-src="{{item.depiction}}">
            </div>
        </div>
    </a>

    <div class="media-body">

        <b>{{item.label.displayLabel || 'Sorry, there is no title available in your preferred languages'}}</b> <a href="{{item.id}}" target="_blank"><span class="glyphicon glyphicon-new-window"></span></a>
        <br />
        <span bind-html-unsafe="item.comment.displayLabel || 'Sorry, there is no description available in your preferred languages' | typeaheadHighlight:searchString"></span>
    </div>
</li>
<li ng-show="!items.length" class="alert alert-danger" style="text-align: center" role="alert">No results</li>
</script>
</textarea>



<ul>
    <ul><a class="label label-primary" href="http://js.geoknow.eu/demos/jassa/pokedex-browser/" target="_blank">Pokemon Demo</a></ul>
</ul>



